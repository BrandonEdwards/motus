<h1>
<a id="user-content-the-motus-r-package-upstream-api" class="anchor" href="#the-motus-r-package-upstream-api" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The motus R package upstream API</h1>
<p>The motus R package maintains your copy of a tag detection database.
The database is built from data provided by a server, typically at
motus.org This document describes the API calls required by the motus
package; i.e. what requests must a server respond to if it is to work
with this package.</p>
<h2>
<a id="user-content-api-calls" class="anchor" href="#api-calls" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>API calls</h2>
<h3>
<a id="user-content-get-batches-by-tag-project" class="anchor" href="#get-batches-by-tag-project" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>get batches by tag project</h3>
<p>batches_for_tag_project (P, TS)</p>
<pre><code>   - P: integer project ID
   - TS: numeric timestamp
</code></pre>
<ul>
<li>
<p>return a list of all batches with detections of tags in project P,
where the tsSG of the batch is &gt;= TS</p>
</li>
<li>
<p>columns in the return value should include these fields (as they exist in the transfer
tables):</p>
<ul>
<li>batchID</li>
<li>motusDeviceID</li>
<li>monoBN</li>
<li>tsBegin</li>
<li>tsEnd</li>
<li>numHits</li>
</ul>
</li>
</ul>
<h3>
<a id="user-content-get-batches-by-receiver-project" class="anchor" href="#get-batches-by-receiver-project" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>get batches by receiver project</h3>
<p>batches_for_receiver_project (P, TS)</p>
<pre><code>   - P: integer project ID
   - TS: numeric timestamp
</code></pre>
<ul>
<li>
<p>return a list of all batches from receivers in project P,
where the tsSG of the batch is &gt;= TS</p>
</li>
<li>
<p>columns should include these fields (as they exist in the transfer
tables):</p>
<ul>
<li>batchID</li>
<li>motusDeviceID</li>
<li>monoBN</li>
<li>tsBegin</li>
<li>tsEnd</li>
<li>numHits</li>
</ul>
</li>
</ul>
<h3>
<a id="user-content-get-runs-by-tag-project-from-given-batch" class="anchor" href="#get-runs-by-tag-project-from-given-batch" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>get runs by tag project from given batch</h3>
<p>runs_for_tag_project (P, B)</p>
<pre><code>   - P: integer project ID
   - B: integer batch ID
</code></pre>
<ul>
<li>
<p>return a list of all runs of a tag in project P, from the batch
with ID = B</p>
</li>
<li>
<p>columns should include these fields (as they exist in the transfer
tables):</p>
<ul>
<li>runID</li>
<li>batchIDbegin</li>
<li>batchIDend</li>
<li>motusTagID</li>
<li>ant</li>
<li>len</li>
</ul>
</li>
</ul>
<h3>
<a id="user-content-get-all-runs-from-given-batch" class="anchor" href="#get-all-runs-from-given-batch" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>get all runs from given batch</h3>
<p>This would be called when building a copy of the receiver database; in
that case, all runs, regardless of tag project, would be provided.</p>
<p>runs_for_batch (B)</p>
<pre><code>   - B: integer batch ID
</code></pre>
<ul>
<li>
<p>return a list of all runs from the batch with ID = B</p>
</li>
<li>
<p>columns should include these fields (as they exist in the transfer
tables):</p>
<ul>
<li>runID</li>
<li>batchIDbegin</li>
<li>batchIDend</li>
<li>motusTagID</li>
<li>ant</li>
<li>len</li>
</ul>
</li>
</ul>
<p>Paging for this query is achieved by using the last returned value of <code>hitID</code>
as <code>H</code> on subsequent calls.</p>
<h3>
<a id="user-content-get-all-hits-by-tag-project-from-given-batch" class="anchor" href="#get-all-hits-by-tag-project-from-given-batch" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>get all hits by tag project from given batch</h3>
<p>hits_for_tag_project_in_batch (P, B, H)</p>
<pre><code>   - P: integer project ID
   - B: integer batchID
   - H: integer largest hitID we *already* have
</code></pre>
<ul>
<li>
<p>return a list of all hits on tags in project P which are in batch B,
and whose hit ID is &gt; H</p>
</li>
<li>
<p>columns should include these fields (as they exist in the transfer
tables):</p>
<ul>
<li>hitID</li>
<li>runID</li>
<li>batchID</li>
<li>ts</li>
<li>sig</li>
<li>sigSD</li>
<li>noise</li>
<li>freq</li>
<li>freqSD</li>
<li>slop</li>
<li>burstSlop</li>
</ul>
</li>
</ul>
<p>Paging for this query is achieved by using the last returned value of <code>hitID</code>
as <code>H</code> on subsequent calls.</p>
<h3>
<a id="user-content-get-all-hits-from-given-batch" class="anchor" href="#get-all-hits-from-given-batch" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>get all hits from given batch</h3>
<p>hits_in_batch (B, H)</p>
<pre><code>    - B: integer batchID
    - H: integer largest hitID we *already* have
</code></pre>
<ul>
<li>
<p>return a list of all hits in batch B whose hit ID is &gt; H</p>
</li>
<li>
<p>columns should include these fields (as they exist in the transfer
tables):</p>
<ul>
<li>hitID</li>
<li>runID</li>
<li>batchID</li>
<li>ts</li>
<li>sig</li>
<li>sigSD</li>
<li>noise</li>
<li>freq</li>
<li>freqSD</li>
<li>slop</li>
<li>burstSlop</li>
</ul>
</li>
</ul>
<h3>
<a id="user-content-get-all-gps-fixes-from-a-given-batch" class="anchor" href="#get-all-gps-fixes-from-a-given-batch" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>get all GPS fixes from a given batch</h3>
<p>Used when a receiver deployment is marked as 'mobile'.</p>
<pre><code> gps_in_batch (B, TS)

    - B: integer batchID
    - TS: largest gps timestamp we *already* have

 - return all GPS fixes from batch B which are later than timestamp TS

 - columns should include these fields (as they exist in the transfer
   tables):
    - ts
    - batchID (optional; this is just B)
    - lat
    - lon
    - alt
</code></pre>
<p>Paging for this query is achieved by using the last returned value of <code>ts</code>
as <code>TS</code> on subsequent calls.</p>
